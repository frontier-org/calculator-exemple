<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="frontier-title" content="Polyglot Calc">
    <meta name="frontier-icon" content="icon.ico">
    <meta name="frontier-width" content="320">
    <meta name="frontier-height" content="470">
    <meta name="frontier-min-width" content="250">
    <meta name="frontier-min-height" content="400">
    <meta name="frontier-resizable" content="true">
    <meta name="frontier-x" content="(screen_w - win_w) / 2">
    <meta name="frontier-y" content="(screen_h - win_h) / 2">

    <link rel="stylesheet" href="winui_3.css">
    
    <style>
        header { padding: 8px; flex-shrink: 0; }
        
        .display-unit {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
            padding: 10px 16px;
        }

        #expr { font-size: 14px; opacity: 0.6; height: 20px; }
        #res { font-size: 48px; font-weight: 600; line-height: 1; }

        .keypad {
            height: 65%; 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 2px;
            padding: 4px;
            flex-shrink: 0;
        }

        .op { background-color: var(--wui-op-bg) !important; }
        .accent { 
            background-color: var(--wui-accent) !important; 
            color: var(--wui-accent-text) !important; 
            border: none;
        }
        .spacer { visibility: hidden; }
    </style>
</head>
<body>

    <header>
        <div class="win-dropdown">
            <select id="engine-selector">
                <option value="calc_c">C Engine</option>
                <option value="calc_cpp">C++ Engine</option>
                <option value="calc_go">Go Engine</option>
                <option value="calc_py">Python Engine</option>
                <option value="calc_node">Node.js Engine</option>
                <option value="calc_java">Java Engine</option>
            </select>
        </div>
    </header>

    <main class="display-unit">
        <div id="expr"></div>
        <div id="res">0</div>
    </main>

    <footer class="keypad">
        <button class="op" onclick="clearAll()">C</button>
        <button class="op" onclick="add('(')">(</button>
        <button class="op" onclick="add(')')">)</button>
        <button class="op" onclick="add('/')">÷</button>

        <button onclick="add('7')">7</button>
        <button onclick="add('8')">8</button>
        <button onclick="add('9')">9</button>
        <button class="op" onclick="add('*')">×</button>

        <button onclick="add('4')">4</button>
        <button onclick="add('5')">5</button>
        <button onclick="add('6')">6</button>
        <button class="op" onclick="add('-')">−</button>

        <button onclick="add('1')">1</button>
        <button onclick="add('2')">2</button>
        <button onclick="add('3')">3</button>
        <button class="op" onclick="add('+')">+</button>

        <div class="spacer"></div>
        <button onclick="add('0')">0</button>
        <button onclick="add('.')">.</button>
        <button class="accent" onclick="calculate()">=</button>
    </footer>

    <script>
        // Variáveis globais que o WinUI.js vai acessar
        const exprDiv = document.getElementById('expr');
        const resDiv = document.getElementById('res');
        window.currentExpr = ""; // Colocado no window para o JS enxergar

        function add(char) {
            window.currentExpr += char;
            exprDiv.innerText = window.currentExpr;
        }

        function clearAll() {
            window.currentExpr = "";
            exprDiv.innerText = "";
            resDiv.innerText = "0";
        }

        function calculate() {
            if (window.currentExpr === "") return;
            const engine = document.getElementById('engine-selector').value;
            const cleanExpr = window.currentExpr.replace(/\s+/g, '');
            window.ipc.postMessage(`${engine}|${cleanExpr}`);
        }

        // Retorno do Rust
        window.Frontier = {
            dispatch: (type, msg) => { resDiv.innerText = msg; }
        };
    </script>

    <script src="winui_3.js"></script>
</body>
</html>
